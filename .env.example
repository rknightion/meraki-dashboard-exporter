# Meraki Dashboard Exporter `.env` template
# Copy this file to `.env` and fill in the required values.

# ============================================================================
# REQUIRED SETTINGS
# ============================================================================

# Meraki Dashboard API key (obtain from the Meraki Dashboard portal)
MERAKI_EXPORTER_MERAKI__API_KEY=

# ============================================================================
# COMMON OPTIONAL SETTINGS
# ============================================================================

# Limit the exporter to a single organisation (otherwise all accessible orgs are scraped)
# MERAKI_EXPORTER_MERAKI__ORG_ID=

# Override the API base URL when using regional endpoints (default shown)
MERAKI_EXPORTER_MERAKI__API_BASE_URL=https://api.meraki.com/api/v1

# Logging level: DEBUG, INFO, WARNING, ERROR, CRITICAL (default: INFO)
MERAKI_EXPORTER_LOGGING__LEVEL=INFO

# ============================================================================
# SERVER CONFIGURATION
# ============================================================================

# HTTP bind address and port for the exporter
MERAKI_EXPORTER_SERVER__HOST=0.0.0.0
MERAKI_EXPORTER_SERVER__PORT=9099

# Prefix all HTTP routes (e.g. when running behind a proxy); leave blank for none
MERAKI_EXPORTER_SERVER__PATH_PREFIX=

# Expose /health endpoint (true/false)
MERAKI_EXPORTER_SERVER__ENABLE_HEALTH_CHECK=true

# ============================================================================
# COLLECTOR SCHEDULING & BEHAVIOUR
# ============================================================================

# Update intervals per tier (seconds). Must satisfy: FAST <= MEDIUM <= SLOW.
MERAKI_EXPORTER_UPDATE_INTERVALS__FAST=60
MERAKI_EXPORTER_UPDATE_INTERVALS__MEDIUM=300
MERAKI_EXPORTER_UPDATE_INTERVALS__SLOW=900

# Collector timeout budget per run (seconds)
MERAKI_EXPORTER_COLLECTORS__COLLECTOR_TIMEOUT=120

# Toggle specific collectors (comma-separated; names are lower-case such as device, organization)
# MERAKI_EXPORTER_COLLECTORS__ENABLED_COLLECTORS=device,organization
# MERAKI_EXPORTER_COLLECTORS__DISABLE_COLLECTORS=clients

# ============================================================================
# MERAKI API TUNING
# ============================================================================

# Retry and batching controls – adjust cautiously based on rate limits
MERAKI_EXPORTER_API__MAX_RETRIES=3
MERAKI_EXPORTER_API__TIMEOUT=30

# Parallel processing limit (Phase 1.1: controls concurrent collectors/organizations)
MERAKI_EXPORTER_API__CONCURRENCY_LIMIT=5

# General batch size for API operations (Phase 1.4: increased from 10 to 20)
MERAKI_EXPORTER_API__BATCH_SIZE=20

# Device-specific batch size (Phase 1.4: increased from 5 to 20)
MERAKI_EXPORTER_API__DEVICE_BATCH_SIZE=20

# Network-specific batch size (Phase 1.4: increased from 10 to 30)
MERAKI_EXPORTER_API__NETWORK_BATCH_SIZE=30

# Client-specific batch size (Phase 1.4: new configurable setting)
MERAKI_EXPORTER_API__CLIENT_BATCH_SIZE=20

# Batch processing delays
MERAKI_EXPORTER_API__BATCH_DELAY=0.5
MERAKI_EXPORTER_API__RATE_LIMIT_RETRY_WAIT=5
MERAKI_EXPORTER_API__ACTION_BATCH_RETRY_WAIT=10

# ============================================================================
# CLIENT COLLECTION (Disable by default)
# ============================================================================

# Enable client metrics (set to true only if required – increases API usage)
# MERAKI_EXPORTER_CLIENTS__ENABLED=false
# (Leave unset to use the default of false)

# Optional DNS resolution settings used by the client collector
# MERAKI_EXPORTER_CLIENTS__DNS_SERVER=
# MERAKI_EXPORTER_CLIENTS__DNS_TIMEOUT=5.0
# MERAKI_EXPORTER_CLIENTS__DNS_CACHE_TTL=21600
# MERAKI_EXPORTER_CLIENTS__CACHE_TTL=3600
# MERAKI_EXPORTER_CLIENTS__MAX_CLIENTS_PER_NETWORK=10000

# ============================================================================
# OPEN TELEMETRY EXPORT (Disabled by default)
# ============================================================================

# Enable OTEL export (requires endpoint to be set)
# MERAKI_EXPORTER_OTEL__ENABLED=false
# MERAKI_EXPORTER_OTEL__ENDPOINT=http://otel-collector:4317
# MERAKI_EXPORTER_OTEL__SERVICE_NAME=meraki-dashboard-exporter
# MERAKI_EXPORTER_OTEL__EXPORT_INTERVAL=60
# Provide JSON object for additional OTEL resource attributes, e.g. {"env":"prod"}
# MERAKI_EXPORTER_OTEL__RESOURCE_ATTRIBUTES={"env":"prod"}

# Metrics export routing - control where each metric type is exported
# Meraki network metrics (meraki_device_*, meraki_network_*, etc.)
# MERAKI_EXPORTER_OTEL__EXPORT_MERAKI_METRICS_TO_PROMETHEUS=true
# MERAKI_EXPORTER_OTEL__EXPORT_MERAKI_METRICS_TO_OTEL=false

# Internal exporter metrics (meraki_exporter_*) - API performance, collector stats
# MERAKI_EXPORTER_OTEL__EXPORT_EXPORTER_METRICS_TO_PROMETHEUS=true
# MERAKI_EXPORTER_OTEL__EXPORT_EXPORTER_METRICS_TO_OTEL=false

# Distributed tracing (requires OTEL enabled with endpoint)
# MERAKI_EXPORTER_OTEL__TRACING_ENABLED=true

# Example configurations:
#
# Mode 1 (Default): Prometheus for all metrics
#   No config needed - uses defaults
#
# Mode 2: Prometheus for Meraki metrics only (hide exporter internals)
#   MERAKI_EXPORTER_OTEL__EXPORT_EXPORTER_METRICS_TO_PROMETHEUS=false
#
# Mode 3: OTEL only for all metrics
#   MERAKI_EXPORTER_OTEL__ENABLED=true
#   MERAKI_EXPORTER_OTEL__ENDPOINT=http://otel-collector:4317
#   MERAKI_EXPORTER_OTEL__EXPORT_MERAKI_METRICS_TO_PROMETHEUS=false
#   MERAKI_EXPORTER_OTEL__EXPORT_EXPORTER_METRICS_TO_PROMETHEUS=false
#   MERAKI_EXPORTER_OTEL__EXPORT_MERAKI_METRICS_TO_OTEL=true
#   MERAKI_EXPORTER_OTEL__EXPORT_EXPORTER_METRICS_TO_OTEL=true
#
# Mode 4: OTEL for internal metrics + Prometheus for Meraki
#   MERAKI_EXPORTER_OTEL__ENABLED=true
#   MERAKI_EXPORTER_OTEL__ENDPOINT=http://otel-collector:4317
#   MERAKI_EXPORTER_OTEL__EXPORT_EXPORTER_METRICS_TO_PROMETHEUS=false
#   MERAKI_EXPORTER_OTEL__EXPORT_EXPORTER_METRICS_TO_OTEL=true
#
# Tracing only (metrics via Prometheus, traces via OTEL)
#   MERAKI_EXPORTER_OTEL__ENABLED=true
#   MERAKI_EXPORTER_OTEL__ENDPOINT=http://otel-collector:4317
#   MERAKI_EXPORTER_OTEL__TRACING_ENABLED=true
#   (metrics flags at default - Prometheus only)

# ============================================================================
# MONITORING & ALERTING
# ============================================================================

# Maximum consecutive failures before the exporter logs a critical error
MERAKI_EXPORTER_MONITORING__MAX_CONSECUTIVE_FAILURES=10

# License expiry warning window (days)
MERAKI_EXPORTER_MONITORING__LICENSE_EXPIRATION_WARNING_DAYS=30

# Metric TTL multiplier (Phase 1.3: multiplier for metric expiration)
# TTL = collection_interval * multiplier (e.g., FAST 60s * 2.0 = 120s TTL)
MERAKI_EXPORTER_MONITORING__METRIC_TTL_MULTIPLIER=2.0

# Histogram buckets for collector duration metrics
MERAKI_EXPORTER_MONITORING__HISTOGRAM_BUCKETS=[0.1,0.5,1.0,2.5,5.0,10.0,30.0,60.0,120.0,300.0]
